---
title: "VFSG for Noise Solution"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include = FALSE}
library(flexdashboard)
library(readxl)
df <- read_excel("VFSG Noise Solution Report Aug 24.xls")
library(dplyr)
```

<style>
body {
  padding-top:0px;
  background-color: #01070A;
  color: #FFFFFF
}
.navbar{
  visibility: hidden
}
.third-box {
  background-color: #BEFF00;
  color: #01070A;
  font-weight: bold
}
</style>

```{r picture, echo = F}
knitr::include_graphics("VSFG Logo to include on viz - dark background.png")
```

Noise Solution is a social purpose organisation which engages youth at risk through informal music mentoring, using an evidence based approach to create the conditions which are likely to positively impact on wellbeing and intrinsic motivation. This presentation shows how their music mentoring sessions effectively improves the wellbeing of the participants, measured using the SWEMWBS questionnaire.

## Basic Information

### Participants

```{r}
participants <- n_distinct(df$UIN)
valueBox(participants, icon = "fa-solid fa-user-group", color = "#BEFF00")
```

### Sessions

```{r}
sessions <- nrow(df)
valueBox(sessions, icon = "fa-regular fa-file", color = "#BEFF00")
```

### **Percentage of Sessions with an increase in the wellbeing score (286 in total)** {.third-box}

```{r}
successful_sessions <- df %>%
  group_by(UIN) %>%
  mutate(n = row_number()) %>%
  ungroup() %>%
  mutate(UIN2 = paste0(UIN, "-", n)) %>%
  mutate(delta = `SWEMWBS End Score` - `SWEMWBS Start Score`, 
         class = case_when(delta > 0 ~ "positive",
                           delta == 0 ~ "none",
                           delta < 0 ~ "negative")) %>%
  count(class) %>%
  mutate(perc = (n / sum(n)) * 100) %>%
  slice(3) %>%
  pull()
gauge(successful_sessions, min = 0, max = 100, symbol = '%', gaugeSectors(success = c(60, 100), warning = c(40, 59), danger = c(0, 39)))
```

The graph on the right shows these sessions, and, if we compare the start scores to the end ones, we notice a significant shift from the "low" wellbeing band (determined, based on national averages, to be between 7 and 21.54) to the "high" wellbeing one (between 23.22 and 26.02).

## Interactive Graph

```{r, fig.width = 7}
library(ggplot2)
pg <- df %>%
  group_by(UIN) %>%
  mutate(n = row_number()) %>%
  ungroup() %>%
  mutate(UIN2 = paste0(UIN, "-", n),
         `First Score` = `SWEMWBS Start Score`,
         `Last Score` = `SWEMWBS End Score`) %>%
  mutate(delta = `Last Score` -`First Score`) %>%
  filter(delta > 0) %>%
  tidyr:::pivot_longer(cols = c(`First Score`, `Last Score`), names_to = "variable", values_to = "values") %>%
  ggplot(aes(values, UIN2)) +
  geom_point(aes(frame = variable, ids = UIN2), color = "#01070A") +
  geom_vline(xintercept = c(7, 21.55, 23.22), color = "gray") +
  theme(legend.position = "none",
        axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        plot.background = element_rect(fill = "#BEFF00"),
        panel.background = element_rect(fill = "#BEFF00")) +
  labs(x = NULL,
       y = NULL) +
  scale_x_continuous(breaks = c(7, 21.55, 23.22))
library(plotly)
ggplotly(pg) %>% 
  config(displayModeBar = FALSE) %>% 
  animation_slider(hide = TRUE) %>% 
  animation_button(x = 0.1, xanchor = "right", y = 0, yanchor = "bottom")
```